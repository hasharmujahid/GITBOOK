# Cross-origin resource sharing (CORS) Explanation & Exploitation

### **WHAT IS SOP?** <a href="#7e14" id="7e14"></a>

The same origin Policy is a security mechanism That restricts how a resource loaded from one origin (domain) can interact with a resource from another origin(domain).

It restricts malicious websites to request data from the authenticated sessions of users on other websites. Mainly save users from CSRF attacks.

**Origin:**

It’s pretty important that you understand what is an Origin. An origin is defined by a protocol, hostname, and port number of the URL. If two websites have the same protocol, hostname, and port they will be classified as same origin websites. If one of the properties is different between them then they will not be the same origin websites.

> Protocol
>
> Hostname
>
> Port

Should be the same for passing the SOP test.

**Example:**

We have 2 websites given below.

* `http://test.com/testapp1/index.html`
* `http://test.com/testapp2/index.html`

Are they from the same origin or not? They are Because if you focus on all of the three properties that we mentioned are the same between the two websites. They have the same protocol `http` so they have the same ports as well because `http` uses port 80 by default. And the hostname of both the websites are same `test.com` . The directories and path after the hostname doesn’t matter because the above checks are enough to test for SOP.

Now we have some understanding of what is SOP we should see what is CORS and why we need it.

### **WHAT IS CORS?** <a href="#e78a" id="e78a"></a>

As we know SOP restricts loading resources outside of the same origin But if we really need to load some important resources that’s where CORS Kicks in it enables controlled access to resources located outside of a given domain. It extends and adds flexibility to the same-origin policy. However, it also provides the potential for cross-domain attacks, if a website’s CORS policy is poorly configured and implemented. An attacker can perform a CSRF attack to inflict damage to the user.

### **WHY DO WE NEED CORS?** <a href="#50ae" id="50ae"></a>

To understand why we need CORS we need to take an example. Let’s assume that we have 2 Websites A and B. Website A needs to load some resources from website B (like an image or some js files) But It fails due to the strict same origin policy (SOP) implemented by developers. This issue can be bypassed using CORS (Cross-origin resource sharing). It helps to add some flexibility to our SOP policy and allows us to load resources from trusted websites.

Because the same-origin policy is so restrictive, many techniques for getting around it have been proposed. Many websites have interactions with subdomains or third-party sites that necessitate complete cross-origin access. Using cross-origin resource sharing, a regulated relaxation of the same-origin policy is possible (CORS).

Headers like Access-Control-Allow-Origin response are used to implement the cors.

### What is the Access-Control-Allow-Origin response header? <a href="#ba2e" id="ba2e"></a>

The Access-Control-Allow-Origin header is included in the response from one website to a request coming from another website, and it defines the request’s permitted origin. If the Access-Control-Allow-Origin matches the origin of the requesting website, the web browser allows access to the response.

**For example:**

suppose a website with the origin `normal-website.com` causes the following cross-domain request:

```
GET /data HTTP/1.1 
Host: robust-website.com 
Origin : https://normal-website.com
```

The server on `robust-website.com` returns the following response:

```
HTTP/1.1 200 OK ... 
Access-Control-Allow-Origin: https://normal-website.com
```

The browser will allow code running on `normal-website.com` to access the response because the origins match.

The specification of `Access-Control-Allow-Origin` allows for multiple origins, or the value `null`, or the wildcard `*`. However, no browser supports multiple origins and there are restrictions on the use of the wildcard `*`.

Now we have enough understanding of What CORS is we can think about vulnerabilities that may arise due to misconfigured CORS implementation.

## Server-generated ACAO header from client-specified Origin header <a href="#3862" id="3862"></a>

Some applications need to allow access to a lot of domains and keeping a list of white-listed domains is a lot of work and any mistake can lead to breaking the functionality. To avoid this work websites allow access from any other domain.

**For example:**

A website receives a request.

Like this:

```
GET /sensitive-victim-data HTTP/1.1 
Host: paypal.comOrigin: https://malicious-website.com 
Cookie: sessionid=...
```

And PayPal server responds with:

```
HTTP/1.1 200 OK 
Access-Control-Allow-Origin: https://malicious-website.com 
Access-Control-Allow-Credentials: true ==> Allows cookie to be included 
```

This response states that the malicious websites have and can make a request to fetch and make a request to our data and can also include our cookie while making the request.

This means any website can make requests for our precious data on a vulnerable PayPal server.

